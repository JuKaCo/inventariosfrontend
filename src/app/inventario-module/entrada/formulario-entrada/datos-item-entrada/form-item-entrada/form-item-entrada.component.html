<p-dialog [header]="displayHeader" [(visible)]="displayFrm" [modal]="true" styleClass="dialog-responsive-80"
    [contentStyle]="{'overflow':'visible'}">
    <form [formGroup]="formulario" *ngIf="tipo!='ver'">
        <!--<input formControlName="id" type="hidden" pInputText>-->
        <div class="p-fluid p-grid">
            <div class="p-field p-col-12 p-md-4">
                <span class="p-float-label">
                    <p-autoComplete formControlName="id_producto" inputId="inp_id_producto" [suggestions]="param.producto"
                        (completeMethod)="getFilter($event,'producto')" field="codigo" [minLength]="1"
                        [dropdown]="true" (onSelect)="selectProducto($event)">
                        <ng-template let-data pTemplate="item">
                            <div><b>({{data.codigo}})</b> <br>Nombre comercial : {{data.nombre_comercial}}</div>
                        </ng-template>
                    </p-autoComplete>
                    <label for="inp_id_producto">P1. Producto<span class="text-danger">*</span></label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['id_producto']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-12 p-md-8">
                <span><b>Nombre comercial : </b>{{nom_comer}}</span>
            </div>
            <div class="p-field p-col-6 p-md-4">
                <span class="p-float-label">
                    <input formControlName="registro_sanitario" type="text" id="inp_registro_sanitario" pInputText>
                    <label for="inp_registro_sanitario">I2. Registro sanitario <span
                            class="text-danger">*</span></label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['registro_sanitario']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-6 p-md-8">
                <span class="p-float-label">
                    <input formControlName="lote" type="text" id="inp_lote" pInputText>
                    <label for="inp_lote">I3. Lote</label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['lote']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-6 p-md-6">
                <span class="p-float-label">
                    <p-calendar formControlName="fecha_exp" dateFormat="dd/mm/yy" [locale]="es" dataType="string" inputId="inp_fecha_exp" [showIcon]="true"></p-calendar>
                    <label for="inp_fecha_exp">I4. Fecha de expiración</label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['fecha_exp']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-6 p-md-6">
                <span class="p-float-label">
                    <!--<p-inputNumber  (onInput)="calc($event,'precio_factura')" formControlName="precio_factura"  id="inp_precio_factura"  [minFractionDigits]="1" [maxFractionDigits]="6"></p-inputNumber>-->
                    <input formControlName="precio_factura" id="inp_precio_factura" pInputText >
                    <label for="inp_precio_factura">I5. Precio factura</label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['precio_factura']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-4 p-md-4">
                <span class="p-float-label">
                    <!--<p-inputNumber (onInput)="calc($event,'cantidad')" formControlName="cantidad" id="inp_cantidad"  mode="decimal"></p-inputNumber>-->
                    <input formControlName="cantidad" id="inp_cantidad" pInputText >
                    <label for="inp_cantidad">I6. Cantidad</label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['cantidad']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
           
            <div class="p-field p-col-4 p-md-4">
                <span class="p-float-label">
                    <!--<p-inputNumber (onInput)="calc($event,'precio_unidad_fob')" formControlName="precio_unidad_fob"  id="inp_precio_unidad_fob"  [minFractionDigits]="1" [maxFractionDigits]="6"></p-inputNumber>-->
                    <input formControlName="precio_unidad_fob" id="inp_precio_unidad_fob" pInputText >
                    <label for="inp_precio_unidad_fob">I7. Precio unidad FOB</label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['precio_unidad_fob']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-4 p-md-4">
                <span class="p-float-label">
                    <p-autoComplete formControlName="factor" inputId="inp_factor" [suggestions]="param.param_factor_precio"
                        (completeMethod)="getFilter($event,'param_factor_precio')" field="valor" [minLength]="1"
                        [dropdown]="true" (onSelect)="calc($event,'factor')">
                        <ng-template let-data pTemplate="item">
                            <div><b>({{data.codigo}})</b> {{data.valor}}</div>
                        </ng-template>
                    </p-autoComplete>
                    <label for="inp_factor">I8. Factor</label>
                </span>
                <app-mesaje-form-error [control]="formulario.controls['factor']" [valid]="formularioValid">
                </app-mesaje-form-error>
            </div>
            <div class="p-field p-col-3 p-md-3">
                <h4>I9 Precio total</h4>
                <span>{{calculo.total || '0'}}</span>
            </div>
            <div class="p-field p-col-3 p-md-3">
                <h4>I10 Costo almacen</h4>
                <span>{{calculo.costo_almacen || '0'}}</span>
            </div>
            <div class="p-field p-col-3 p-md-3">
                <h4>I11 Costo neto</h4>
                <span>{{calculo.costo_neto || '0'}}</span>
            </div>
            <div class="p-field p-col-3 p-md-3">
                <h4>I12 Precio venta</h4>
                <span>{{calculo.precio_venta || '0'}}</span>
            </div>
        </div>
    </form>
    <div *ngIf="tipo=='ver'">
        <div class="p-fluid p-grid" *ngIf="ver$ | async">
            <div class="p-field p-col-12 p-md-8">
                <span class="ver-datos">P1. Producto</span>
                <b>Codigo : {{datos.id_producto.codigo}}</b><br>
                {{datos.id_producto.medicamento}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I2. Registro sanitario</span>
                {{datos.registro_sanitario}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I3. Lote</span>
                {{datos.lote}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I4. Fecha de expiración</span>
                {{datos.fecha_exp}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I5. Precio factura</span>
                {{datos.precio_factura | number:'1.0-5'}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I6. Cantidad</span>
                {{datos.cantidad}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I7. Precio unidad FOB</span>
                {{datos.precio_unidad_fob | number:'1.0-5'}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I8. Factor</span>
                {{datos.factor.valor}} : {{datos.factor.codigo}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I9 Precio total</span>
                {{datos.precio_total | number:'1.0-5'}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I10 Costo almacen</span>
                {{datos.costo_almacen | number:'1.0-5'}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I11 Costo neto</span>
                {{datos.costo_neto | number:'1.0-5'}}
            </div>
            <div class="p-field p-col-12 p-md-4">
                <span class="ver-datos">I12 Precio venta</span>
                {{datos.precio_venta | number:'1.0-5'}}
            </div>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button (click)="displayFrm=false;" icon="pi pi-times" label="Cerrar"
            styleClass="p-button-raised p-button-text"></p-button>
        <p-button (click)="confirmarGuardar($event)" label="Guardar" icon="pi pi-save" *ngIf="tipo=='crear'"></p-button>

        <p-button (click)="confirmarEditar($event)" label="Modificar" icon="pi pi-save" *ngIf="tipo=='editar'">
        </p-button>
    </ng-template>
</p-dialog>